<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Image Cropper 5000</title>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Orbitron:wght@700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0a0018; /* deep space */
      --grid:#2affd3; /* neon cyan */
      --magenta:#ff2ad4;
      --cyan:#2afff5;
      --yellow:#ffe14d;
      --card:#140032;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background: radial-gradient(1200px 600px at 50% -10%, #1b0047, var(--bg)) fixed;
      color:white; font-family:"Orbitron", system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      display:flex; align-items:center; justify-content:center; padding:24px;
      position:relative; overflow-x:hidden;
    }
    .grid{
      pointer-events:none; position:fixed; inset:0; opacity:.25;
      background-image:
        linear-gradient(transparent 0 98%, var(--grid) 99%),
        linear-gradient(90deg, transparent 0 98%, var(--grid) 99%);
      background-size: 40px 40px;
      transform: perspective(900px) rotateX(60deg) translateY(40%);
      filter: drop-shadow(0 0 6px var(--grid));
      padding-bottom: 80px;
    }

    .wrap{ width: min(980px, 100%); }

    .title{
      font-family:"Press Start 2P", monospace; text-align:center; margin:50px 0; font-size: clamp(24px, 6vw, 44px);
      letter-spacing:2px;
      text-shadow: 0 0 8px var(--magenta), 0 0 18px var(--cyan);
      margin-top: 100px;
    }

    .card{
      background: linear-gradient(145deg, #1a003f, #0b0124);
      border: 3px solid var(--magenta);
      box-shadow: 0 0 20px rgba(255,42,212,.35), inset 0 0 12px rgba(42,255,245,.1);
      border-radius: 16px; padding: 18px; position:relative;
      padding-top: 24px;
    }
    .legend {
      position:absolute; top:-4px; padding:6px 10px; background:var(--card);
      border:2px solid var(--cyan); border-radius:10px; font-size:12px; color:var(--yellow);
      text-transform:uppercase; letter-spacing:1px;
      text-shadow: 0 0 6px var(--yellow);
       left: 50%;
  transform: translate(-50%, -50%); /
    }

    .row{ display:flex; flex-wrap:wrap; gap:12px; align-items:center; }
    label{ font-size:12px; color:#c7f7ff; text-transform:uppercase; letter-spacing:1px; }
    input[type="url"], select{
      flex:1 1 460px; padding:12px 14px; border-radius:12px; border:2px solid var(--cyan);
      background:#0a0120; color:white; outline:none; font-family:inherit; font-size:14px;
      box-shadow: inset 0 0 10px rgba(42,255,245,.15);
    }
    button{
      font-family:"Press Start 2P", monospace; font-size:12px; line-height:1.2; letter-spacing:1px;
      border:3px solid var(--yellow); color:#0a0120; background:var(--yellow); border-radius:12px; padding:12px 16px;
      cursor:pointer; text-transform:uppercase; transition:.18s transform ease, .18s filter ease;
      filter: drop-shadow(0 0 10px rgba(255,225,77,.35));
    }
    button:hover{ transform: translateY(-2px); }
    button:disabled{ opacity:.6; cursor:not-allowed; filter:none; }

    .canvas-wrap{
      margin-top:16px; display:grid; place-items:center; gap:10px;
      border:2px dashed var(--cyan); border-radius:16px; padding:16px;
      background: linear-gradient(180deg, rgba(42,255,245,.06), transparent);
    }
    canvas{ width:100%; max-width: 100%; height:auto; image-rendering:auto; border-radius:12px; }

    .hint{ font-size:12px; opacity:.85; color:#d5caff }
    .error{ color:#ff9ad4; font-weight:700; text-shadow:0 0 6px rgba(255,42,212,.6) }
    .footer{ margin-top:12px; font-size:11px; opacity:.9 }
    .tag{ color:var(--cyan) }
  </style>
</head>
<body>
  <div class="grid"></div>
  <main class="wrap">
  <br><br><br>
    <h1 class="title">IMAGE CROPPER 5000</h1>

    <section class="card">
      <div class="legend">You drop it, we crop it!</div>
      <div class="row" style="margin-top:8px">
        <label for="imgUrl">Image URL</label>
        <input id="imgUrl" type="url" placeholder="https://example.com/picture.jpg" spellcheck="false"/>
        <select id="sizeSelect">
          <option value="540x290">540×290</option>
          <option value="1200x627">1200×627</option>
        </select>
        <button id="loadBtn">Crop!</button>
        <button id="downloadBtn" disabled>Download</button>
      </div>
      <p class="hint">Paste any image URL. Toggle between <strong>540×290</strong> and <strong>1200×627</strong> using the dropdown. We’ll scale-to-fill and center-crop.</p>
      <div class="canvas-wrap">
        <canvas id="c" width="540" height="290" aria-label="Cropped output"></canvas>
      </div>
      <p id="msg" class="hint"></p>
      <div class="footer">Mode: <span class="tag" id="mode">idle</span></div>
    </section>
    <br><br><br>
  </main>

<script>
  const input = document.getElementById('imgUrl');
  const loadBtn = document.getElementById('loadBtn');
  const dlBtn = document.getElementById('downloadBtn');
  const canvas = document.getElementById('c');
  const ctx = canvas.getContext('2d');
  const msg = document.getElementById('msg');
  const mode = document.getElementById('mode');
  const sizeSelect = document.getElementById('sizeSelect');

  const PROXIES = {
    isogit: (u) => `https://cors.isomorphic-git.org/${u}`,
    weserv: (u) => {
      try{
        const url = new URL(u);
        const stripped = `${url.host}${url.pathname}${url.search}`;
        return `https://images.weserv.nl/?url=${encodeURIComponent(stripped)}`;
      }catch{ return `https://images.weserv.nl/?url=${encodeURIComponent(u.replace(/^https?:\/\//i,''))}`; }
    }
  };

  function setStatus(text, type="info"){ msg.textContent = text; msg.className = type === 'error' ? 'hint error' : 'hint'; }
  function setMode(text){ mode.textContent = text; }

  loadBtn.addEventListener('click', () => startLoad());
  input.addEventListener('keydown', (e)=>{ if(e.key==='Enter') startLoad(); });
  dlBtn.addEventListener('click', downloadImage);
  sizeSelect.addEventListener('change', updateCanvasSize);

  function updateCanvasSize(){
    const [w,h] = sizeSelect.value.split('x').map(Number);
    canvas.width = w;
    canvas.height = h;
    setStatus(`Canvas size set to ${w}×${h}`);
  }

  async function startLoad(){
    const raw = (input.value || '').trim();
    if(!raw){ setStatus('Enter an image URL to begin.'); return; }

    dlBtn.disabled = true; setMode('loading'); setStatus('Loading image…');

    const candidates = buildCandidates(raw);
    for(let i=0; i<candidates.length; i++){
      try{
        const src = candidates[i];
        const img = await loadImage(src);
        drawCover(img);
        try{ canvas.toDataURL('image/png'); setStatus(`Loaded${src!==raw?` via proxy`:' '} ✔`); }
        catch{ setStatus('Loaded, but the origin blocks downloads. Trying a proxy…'); continue; }
        dlBtn.disabled = false; setMode(src===raw ? 'direct' : 'proxied');
        return;
      }catch(err){
        console.warn('Attempt failed', err);
        setStatus(`Attempt ${i+1} failed. Trying another route…`);
      }
    }
    setMode('failed'); setStatus('Could not load this URL due to cross-origin restrictions or it is not an image.', 'error');
  }

  function buildCandidates(u){
    let url = u.replace(/^http:\/\//i, location.protocol === 'https:' ? 'https://' : 'http://');
    return [
      url,
      PROXIES.isogit(url),
      PROXIES.weserv(url),
    ];
  }

  function loadImage(src){
    return new Promise((resolve, reject)=>{
      const img = new Image();
      img.crossOrigin = 'anonymous';
      img.onload = () => resolve(img);
      img.onerror = () => reject(new Error('Image failed to load: '+src));
      img.src = src;
    });
  }

  function drawCover(img){
    const cw = canvas.width, ch = canvas.height;
    ctx.clearRect(0,0,cw,ch);
    const ir = img.width / img.height;
    const cr = cw / ch;
    let dw, dh;
    if(ir > cr){ dh = ch; dw = ir * dh; } else { dw = cw; dh = dw / ir; }
    const dx = (cw - dw)/2;
    const dy = (ch - dh)/2;
    ctx.imageSmoothingEnabled = true;
    ctx.imageSmoothingQuality = 'high';
    ctx.drawImage(img, dx, dy, dw, dh);
  }

  function downloadImage(){
    canvas.toBlob((blob)=>{
      if(!blob){ setStatus('Could not create image blob.', 'error'); return; }
      const a = document.createElement('a');
      const url = URL.createObjectURL(blob);
      a.href = url; a.download = `image-${canvas.width}x${canvas.height}.png`;
      document.body.appendChild(a); a.click(); a.remove();
      setTimeout(()=>URL.revokeObjectURL(url), 5000);
    }, 'image/png');
  }

  window.addEventListener('load', ()=> input.focus());
</script>
</body>
</html>
